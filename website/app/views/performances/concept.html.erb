<% content_for :for_head do %>
	<title>Performance Data</title>	
<style>

#mainpage {
	width: 1200px;
	margin: 0 auto;
}

#reports {
	width: 600px;
	text-align: left;
	align: center;
}
</style>
<% end %>
<script>
$(document).ready(function(){
    $.ajaxSetup({ cache: false });
    $(document).on('click', '.glyphicon', function(){
	if ($(this).hasClass('glyphicon-menu-right')) {
       	 	$(this).removeClass('glyphicon-menu-right');
       		$(this).addClass('glyphicon-menu-down');
    	}
	else {
       	 	$(this).removeClass('glyphicon-menu-down');
       		$(this).addClass('glyphicon-menu-right');
	}

	if ($(this).next().hasClass('subdata')) {
        	$(this).next().slideToggle();
	}
	else {
		var level = $(this).attr("id");
        	// Get data from model
		$.ajax({
  			type:"GET",
  			url:"data",
  			dataType:"html",
  			data: {l: level},
  			success: function(data){
    				$("#" + level).after(data);
  			}
		});
	}
    }); 
    $(document).on('mouseenter mouseleave', '.endDx', function(){
	$(this).next().stop().slideToggle();
    });
});
</script>
<a href="top">
<p></p>
<%= render "nav" %>
<p></p>
<div style="padding-bottom: 30px">
<b>Key:</b>
<%= image_tag("grey.gif", width: "15px", height: "15px") %> No cases attempted yet 
<span width="20"></span>
<%= image_tag("green.gif", width: "15px", height: "15px") %> Excellent 
<span width="20"></span>
<%= image_tag("yellow.gif", width: "15px", height: "15px") %> Good 
<span width="20"></span>
<%= image_tag("red.gif", width: "15px", height: "15px") %> Needs more work 
</div>

<% @dxlevel1s.each do |d1| %>
<table class="table" style="max-width: 600px; text-align: left; margin: 0 auto">
  <tr>
  <td>
<% @ldx = LearnerLevel1.where(:dx_level1_id => d1.id).where(:user_id => current_user.id).first %>
  <% if (@ldx.nil?) or (@ldx.cases_attempted == 0) %>    
  <%= image_tag("grey.gif", width: "15px", height: "15px") %> 
<% else %>
  <% @correct = @ldx.correct_dx/@ldx.cases_attempted*1.00 %>
  <% @excellent = @ldx.excellent_cases/@ldx.cases_attempted*1.00 %>
  <% if @excellent > 0.5 %>
    <%= image_tag("green.gif", width: "15px", height: "15px") %>  
  <% elsif @correct > 0.5 %>
    <%= image_tag("yellow.gif", width: "15px", height: "15px") %> 
  <% else %>
    <%= image_tag("red.gif", width: "15px", height: "15px") %> 
  <% end %>
<% end %>
  <%= d1.name %> <% @id = "l1_" + d1.id.to_s %> <%= content_tag :span, "", id: @id, class: "glyphicon glyphicon-menu-right" %>
  </td>
  </tr>
</table>
<% end %>
<p></p>
<a href="#top">Back to top</a>
<table style="height: 30px"><tr><td></td></tr></table>
  <!-- Modal -->
  <div class="modal fade" id="modal-window" width="1000" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="thing">Report review</h4>
        </div>
        <div class="modal-body">
          <table><tr>
	<td width="300">
	IMAGE HERE
	</td>
	<td>
<h4>Report corrections</h4>
CT ABDOMEN & PELVIS - PLAIN L3  CLINICAL: SECOND EPISODE OF RENAL COLIC.  NON CONTRAST CT OF THE RENAL TRACT HAS BEEN PERFORMED. MILD RIGHT SIDED HYDRONEPHROSIS EXTENDING DOWN TO AND OBSTRUCTING CALCULUS AT SOME 4 TO 5CM PROXIMAL TO THE RIGHT VUJ AND IS APPROXIMATELY 5MM IN LENGTH. RETICULATION CAN BE SEEN OF THE RIGHT PERINEPHRIC SPACE  EXTENDING INFERIORLY TO THE L4/5 LEVEL. THIS MOST LIKELY REPRESENTS FLUID IN THE RIGHT PERINEPHRIC SPACE. SMALL FOCI OF CALCIFICATION CAN BE SEEN IN THE RIGHT MID POLE, RIGHT LOWER POLE AND LEFT LOWER POLE. BOTH KIDNEYS ARE IRREGULAR IN OUTLINE. PREVIOUS CHOLECYSTECTOMY IS NOTED.  COMMENT: 5MM OBSTRUCTING CALCULUS AT THE RIGHT PELVIC URETER RESULTING IN MILD RIGHT HYDRONEPHROSIS.
	</td></tr></table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>


