<% content_for :for_head do %>
	<title>Performance Data</title>
<style>

#mainpage {
	width: 1200px;
	margin: 0 auto;
}

#reports {
	width: 600px;
	text-align: left;
	align: center;
}
</style>

	<!-- <script src="/index_files/chart.js"></script> -->

<% end %>
	<!-- JQuery library must be loaded before Highcharts code for it to work-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="/index_files/customEvents.js"></script>

<!-- <div style="max-width: 1400px; position: absolute; bottom: 40%; left: 0; right: 0; margin: auto; max-height: 100%; height: auto;" >
</div> -->

<div class="row container" style="max-width: 800px; margin: 0 auto">
<%= render "nav" %>

<p>
<% if @level == 2 %>
<span style="align: left"><%= link_to "Back", list_performances_path %></span>
</p>
<p>
You are here: <%= link_to "Body systems", list_performances_path %> > <%= @dxlevel1.name %>
<% elsif @level == 3 %>
<%= link_to "Body systems", list_performances_path %> > <%= link_to @dxlevel1.name, list_performances_path %> > <%= @dxlevel2.name %>
<% elsif @level == 4 and @dxlevel3.nil? %>
<%= link_to "Body systems", list_performances_path %> > <%= link_to @dxlevel1.name, list_performances_path %> > <%= @dxlevel2.name %>
<% elsif !@dxlevel3.nil? and @level == 4 %>
<%= link_to "Body systems", list_performances_path %> > <%= link_to @dxlevel1.name, list_performances_path %> > <%= link_to @dxlevel2.name, list_performances_path %> > <%= @dxlevel3.name %>

<% end %>
<p>
<table class="table">
    <tr>
    <td style="width: 190px">
        <b> 
        <% if @level == 1 %>
            Body systems
        <% elsif @level == 2 %>
            <%= @dxlevel1.name %>
        <% elsif @level == 3 %>
	    <%= @dxlevel2.name %>
        <% else %>
	   <% if @dxlevel3.nil? and @level == 4 %>
		<%= @dxlevel2.name %>
	    <% else %>
		<%= @dxlevel3.name %>
	   <% end %>
        <% end %></b>
    </td>
    <td style="width: 110px">
        <b>Total reports</b>
    </td>
    <td style="width: 130px">
        <b>Correct diagnoses</b>
    </td>
    <td style="width: 120px">
        <b>Excellent reports</b>
    </td>
    </tr>
    <!-- Default: Level 1 diagnoses -->
    <% if @level == 1 %>
    <% @learner_level1s.each do |l| %>
    <tr>
    <td>
        <%= link_to list_performances_path(:l1 => l.id) do-%>
	<%= l.name %> <span class="glyphicon glyphicon-triangle-right"></span>
	<% end %>
    </td>
    <td>
        <%= l.cases_attempted %>
    </td>
    <td>
        <% if l.cases_attempted != 0 %>
        <% @correct = (l.correct_dx/l.cases_attempted.to_f)*100.00 %>
        <%= sprintf('%.2f', @correct) %>%
        <% else %>
            -
        <% end %>
    </td>
    <td>
        <% if l.excellent_cases != 0 %>
        <% @excellent = (l.excellent_cases/l.cases_attempted.to_f)*100.00 %>
        <%= sprintf('%.2f', @excellent) %>%
        <% else %>
            -
        <% end %>
    </td>
    </tr>
    <% end %>
    <!-- Level 2 diagnoses -->
    <% elsif @level == 2 %>
    <% @dxlevel2s.each do |d| %>
    <% l = LearnerLevel2.where(:dx_level2_id => d.id, :user_id => current_user.id).first %>
    <tr>
    <td>
        <% if l.present? %>
            <%= link_to list_performances_path(:l2 => l.id) do-%>
	    <%= l.name %> <span class="glyphicon glyphicon-triangle-right"></span>
	    <% end %>
            </td>
            <td>
            <%= l.cases_attempted %>
            </td>
            <td>
            <% if l.cases_attempted != 0 %>
                <% @correct = (l.correct_dx/l.cases_attempted.to_f)*100.00 %>
                <%= sprintf('%.2f', @correct) %>%
                </td>
                <td>
                <% @excellent = (l.excellent_cases/l.cases_attempted.to_f)*100.00 %>
                <%= sprintf('%.2f', @excellent) %>%
            <% else %>
                -
                </td>
                <td>
                -
            <% end %>
        <% else %>
            <%= d.name %>
            </td>
            <td>
            0
            </td>
            <td>
            -
            </td>
            <td>
            -
        <% end %>
    </td>
    </tr>
    <% end %>
 
    <tr>
    <td></td><td></td><td></td><td></td>
    </tr>
    <tr>
    <td style="width: 190px">
        <b><%= @dxlevel1.name %> key conditions</b>
    </td>
    <td style="width: 110px">
        <b>Total reports</b>
    </td>
    <td style="width: 130px">
        <b>Correct diagnoses</b>
    </td>
    <td style="width: 120px">
        <b>Excellent reports</b>
    </td>
    </tr>
    <!-- Level 2: Key conditions -->
    <% @keyconditions.each do |d| %>
    <% l = LearnerDx.where(:end_dx_id => d.id, :user_id => current_user.id).first %>
    <tr>
    <td>
        <% if l.present? %>
            <%= l.name %>
            </td>
            <td>
            <%= l.cases_attempted %>
            </td>
            <td>
            <% if l.cases_attempted != 0 %>
                <% @correct = (l.correct_dx/l.cases_attempted.to_f)*100.00 %>
                <%= sprintf('%.2f', @correct) %>%
                </td>
                <td>
                <% @excellent = (l.excellent_cases/l.cases_attempted.to_f)*100.00 %>
                <%= sprintf('%.2f', @excellent) %>%
            <% else %>
                -
                </td>
                <td>
                -
            <% end %>
        <% else %>
            <%= d.name %>
            </td>
            <td>
            0
            </td>
            <td>
            -
            </td>
            <td>
            -
        <% end %>
    </td>
    </tr>
    <% end %>
<!-- Level 3 diagnoses -->
    <% elsif @level == 3 %>
    <% @dxlevel3s.each do |d| %>
    <% l = LearnerLevel3.where(:dx_level3_id => d.id, :user_id => current_user.id).first %>
    <tr>
    <td>
        <% if l.present? %>
            <%= link_to list_performances_path(:l3 => l.id) do-%>
	    <%= l.name %> <span class="glyphicon glyphicon-triangle-right"></span>
	    <% end %>
            </td>
            <td>
            <%= l.cases_attempted %>
            </td>
            <td>
            <% if l.cases_attempted != 0 %>
                <% @correct = (l.correct_dx/l.cases_attempted.to_f)*100.00 %>
                <%= sprintf('%.2f', @correct) %>%
                </td>
                <td>
                <% @excellent = (l.excellent_cases/l.cases_attempted.to_f)*100.00 %>
                <%= sprintf('%.2f', @excellent) %>%
            <% else %>
                -
                </td>
                <td>
                -
            <% end %>
        <% else %>
            <%= d.name %>
            </td>
            <td>
            0
            </td>
            <td>
            -
            </td>
            <td>
            -
        <% end %>
    </td>
    </tr>
    <% end %>
 <!-- End diagnoses -->
    <% elsif @level == 4 %>
    <% @end_dxes.each do |e| %>
    <% l = LearnerDx.where(:end_dx_id => e.id, :user_id => current_user.id).first %>
    <tr>
    <td>
        <% if l.present? %>
            <%= l.name %>
            </td>
            <td>
            <%= l.cases_attempted %>
            </td>
            <td>
            <% if l.cases_attempted != 0 %>
                <% @correct = (l.correct_dx/l.cases_attempted.to_f)*100.00 %>
                <%= sprintf('%.2f', @correct) %>%
                </td>
                <td>
                <% @excellent = (l.excellent_cases/l.cases_attempted.to_f)*100.00 %>
                <%= sprintf('%.2f', @excellent) %>%
            <% else %>
                -
                </td>
                <td>
                -
            <% end %>
        <% else %>
            <%= e.name %>
            </td>
            <td>
            0
            </td>
            <td>
            -
            </td>
            <td>
            -
        <% end %>
    </td>
    </tr>
    <% end %>
    <% end %>
</table>
</div>






